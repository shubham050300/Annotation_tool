
<html lang="en">

<head>
  <title>Labelling Tool</title>       

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <script src="https://demos.jquerymobile.com/1.4.2/js/jquery.js"></script>
  <link rel="stylesheet" href="https://demos.jquerymobile.com/1.4.2/css/themes/default/jquery.mobile-1.4.2.min.css">  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- <script async src="opencv.js" onload="alert("loaded");" type="text/javascript"></script> -->

  <link rel = "stylesheet" type = "text/css" href = "labelStyle.css" />

  <script src="canvas.js"></script> 
  <script src="threshold.js"></script> 
  <script src="median.js"></script> 
  <!-- <script src="processing.js" onload="alert('loaded')" type="text/javascript"></script> -->

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="jmag.js" type="text/javascript"></script>



  <!-- <script src="processing.js" onload="alert( "eee" ); "></script>  -->

  <script src="morph.js"></script> 
  <script type="text/javascript" src="connected.js"></script>

  <!-- <script src="imageprocessing.js"></script>  -->


</head>


<body>

  <div class="container-fluid">
    <h1 style="background-color:lavender;  text-align: center; " >Image annotator </h1>
    <br>
    <!-- <p style=" text-align: center; " > Upload your image</p> -->

  </div>

  <div class="container-fluid">
  <!-- ----------------------------------------------------------------------------------------------------- -->

    <div class="row">
      <div class="col-sm-2 imagedisplay" >
<!--        <input id="imageupload" type="file" style="width: 0.1px; height: 0.1px;" onchange="Display(this); threshold() ;">
       <br> -->


       <label for="imageupload" class="custom-imageupload">
        <i></i>Upload Image
      </label>
      <input id="imageupload" type="file" onchange="Display(this); threshold() ;" />


    </div>



      <div class="col-sm-6" >
        <!-- <br> -->
       <input type="range" min="0" max="255" value="0" class="slider red" id="S1"> <br> 
     </div>



    <div class="col-sm-1">
      <button type="button" onclick="toggle();"> Toggle </button>
    </div>

    <div class="col-sm-1">
      <!-- <button type="button" onclick="filter();"> Predict </button> -->
      <button type="button" onclick="dilateCanvas();"> Fill Holes </button>
    </div>

    <div class="col-sm-2">
      <button type="button" onclick="alert('Hello world!')"> Download </button>
    </div>
    <div class="col-sm-1">
      <button type="button" onclick="conn();"> Count </button>
    </div>



   </div>


<!-- ----------------------------------------------------------------------------------------------------- -->
    <div class="row" id="CanvasRow">
      <div class="col-sm-10 imagedisplay" >
        <br>
        <canvas  id="Q2"  width=1000px height=500px > </canvas>
        <canvas  id="Q3" class="small" width=1000px height=500px  > </canvas>
        <canvas  id="Q4" width=1200px height=700px  > </canvas>

        <canvas id="zoom" width="400" height="200" style="position:absolute; top:0; left:0; display:none" ></canvas>

        <!-- <div style="position:absolute;top:17%;left:47%;width:10px;height:10px;background:black;" id="black" onclick="color(this)"></div> -->
        <!-- <div style="position:absolute;top:22%;left:45%;width:15px;height:15px;background:white;border:2px solid;" id="white" onclick="color(this)"> </div> -->
        <script src="draw.js"></script>
        <script src="mag.js"></script>

      </div>
      <div class="col-sm-1" > </div>

      <div class="col-sm-1" >
        <br>
        <br>
        <br>
        <br>
        <br>
        <button class="btnhead">Tools</button> <br> <br>
        <div class="btn-group">

        <!-- <button class="btn"><i class="fa fa-home"></i></button> -->
        <!-- <button class="btn"><i class="fas fa-eraser"></i></button> -->
        <button class="btn" onclick="getPencil()"><i class="glyphicon glyphicon-pencil"></i></button>
        <button class="btn" onclick="getErasor()"><i class="glyphicon glyphicon-erase"></i></button>
        <!-- <button class="btn"><i class="glyphicon glyphicon-plus"></i></button>
        <button class="btn"><i class="  glyphicon glyphicon-minus-sign"></i></button>
 -->
      </div>


        <br>
        <br>
        <br>
        <br>
        <!-- <button class="btnhead">Size</button> <br> <br> -->
        <!-- <div class="btn-group"> -->
        <!-- <button>Small</button> <br> <br> -->
        <!-- <button>Large</button> <br> <br> -->
        <!-- <button>Huge</button> <br> <br> -->
        <!-- <button> + </button> <br> <br> -->
        <!-- <button> - </button> <br> <br> -->
      <!-- </div> -->


        <button class="btnhead">Actions</button> <br> <br>
        <div class="btn-group">

        <!-- <button class="btn"><i class="fa fa-home"></i></button> -->
        <!-- <button class="btn"><i class="fas fa-eraser"></i></button> -->
        <!-- <button class="btn"><i class="glyphicon glyphicon-pencil"></i></button> -->
        <!-- <button class="btn"><i class="glyphicon glyphicon-erase"></i></button> -->
        <button class="btn" onclick="increaseSize()"><i class="glyphicon glyphicon-plus"></i></button>
        <button class="btn" onclick="decreaseSize()"><i class="  glyphicon glyphicon-minus-sign"></i></button>      

      <!-- </div> -->
      <!-- <div> -->
        <br> <br> 
        

        <button class="readysize" onclick="customSize('S')">S</button>
        <button class="readysize" onclick="customSize('M')">M</button>
        <button class="readysize" onclick="customSize('L')">L</button>
        <button class="readysize" onclick="customSize('H')">H</button>

        <br> <br> <br>

        <br>
        <br>
        <button class="btncenter" onclick="mag()"> <i class="fa fa-search"></i></button>      

        </div>
        <!-- <canvas  id="Q2"  width=1700px height=700px > </canvas> -->
        <!-- <canvas  id="Q3" width=1700px height=700px  > </canvas> -->

        <!-- <div style="position:absolute;top:17%;left:47%;width:10px;height:10px;background:black;" id="black" onclick="color(this)"></div> -->
        <!-- <div style="position:absolute;top:22%;left:45%;width:15px;height:15px;background:white;border:2px solid;" id="white" onclick="color(this)"> </div> -->
        <!-- <script src="draw.js"></script>  -->

      </div>



    </div>



<!-- ----------------------------------------------------------------------------------------------------- -->
      
</div>
<script type="text/javascript">
  function conn(){
  var canv4 = document.getElementById("Q3");
    var context4 = canv4.getContext("2d");
    var binImg1 = context4.getImageData(0, 0, canv4.width, canv4.height);
    // context3.scale(1/2, 1/2);
    // var cnvImg1 = context4.getImageData(0, 0, canv4.width, canv4.height);
    // var binImg1 = [];
    // for (i = 0; i < cnvImg1.data.length; i += 4)  {
    //   if (cnvImg1.data[i] + cnvImg1.data[i+1] + cnvImg1.data[i+2] + cnvImg1.data[i+3] > 255) {
    //     binImg1.push(1);
    //   } else {
    //     binImg1.push(0);
    //   }
    // }
    
    var arr = [];
  var vis = [];
  for(i = 0; i < canv4.height; i++) 
  {
   arr[i] = [];
   vis[i] = [];
   for(j = 0; j < canv4.width; j++) 
   {
     var s = 4 * i * canv4.width + 4 * j;
     if(binImg1.data[s] > 0 )
     {
       arr[i][j] = 1;  
     }
     else
      {
       arr[i][j] = 0;
         // console.log(s);
      }
      vis[i][j] = -1;

     }
   }
    //console.log(binImg1);
    var count = Count(arr);
    
    // labels = BlobExtraction(binImg1, canv4.width,canv4.height);
    // counter=BlobBounds(labels,canv4.width,canv4.height);
    // alert(labels);
    //alert();
//var binImgdata=binImg1.getImageData(0, 0, canv4.width, canv4.height).data;
//console.log(binImgdata);
}

</script>
<script type="text/javascript">
  


  function add(accumulator, a) {
    return accumulator + a;
  }

  function dilateCanvas() {
    var canv3 = document.getElementById("Q3");
    var context3 = canv3.getContext("2d");
    // context3.scale(1/2, 1/2);
    var cnvImg = context3.getImageData(0, 0, canv3.width, canv3.height);
    var binImg = [];
    for (i = 0; i < cnvImg.data.length; i += 4)  {
      if (cnvImg.data[i] + cnvImg.data[i+1] + cnvImg.data[i+2] + cnvImg.data[i+3] > 255) {
        binImg.push(1);
      } else {
        binImg.push(0);
      }
    }
    var morph = new Morph(canv3.width, canv3.height, binImg);
    // console.log(morph.data.reduce(add));
    morph.dilateWithElement();
    // console.log(morph.data.reduce(add));

    context3.clearRect(0, 0, canv3.width, canv3.height);
    cnvImg = context3.getImageData(0, 0, canv3.width, canv3.height);
    for (i = 0; i < cnvImg.data.length; i += 4)  {
      if (morph.data[i/4] == 1) {
        cnvImg.data[i] = cnvImg.data[i+3] = 255;
        cnvImg.data[i+1] = cnvImg.data[i+2] = 0;
      } else {
        cnvImg.data[i] = cnvImg.data[i+1] = cnvImg.data[i+2] = cnvImg.data[i+3] = 0;
      }
    }

    context3.putImageData(cnvImg, 0, 0);
    // return morph;
  }

</script>

</body>
</html>



<!-- 
<html>

<body>
	<p>This is a paragraph.</p>



</body>
</html> -->