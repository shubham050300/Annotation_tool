
<html lang="en">

<head>
  <title>Labelling Tool</title>

  <meta   charset="utf-8">
  <meta   name="viewport" content="width=device-width, initial-scale=0.8 ">
  <link   rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <script src="https://demos.jquerymobile.com/1.4.2/js/jquery.js"></script>
  <link   rel="stylesheet" href="https://demos.jquerymobile.com/1.4.2/css/themes/default/jquery.mobile-1.4.2.min.css">
  <link   rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


 <link rel="stylesheet" href="{{ url_for('static', filename='css/labelStyle.css') }}">

  <script src="/static/canvas.js"></script>
  <script src="/static/threshold.js"></script>
  <script src="/static/median.js"></script>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

  <script src="/static/morph.js"></script>
  <script type="text/javascript" src="/static/connected.js"></script>


<style>
      .navbar-brand
      {
        font-size: 40px;
      }

      label{
          color: lightblue;
          font-size: 20px;
          font-style: cursive;
      }


    nav.left_side{
      float: left;
      width: 30%;
      height: 100vh;
      background: #ccc;
      padding: 20px;
    }


</style>

</head>


<body style="background-color: white">


<nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="http://cvit.iiit.ac.in/">CVIT Home page</a>
            </li>
        </ul>
    </div>
    <div class="mx-auto order-0">
        <a class="navbar-brand mx-auto" href="#">PEACOCK ANNOTATION TOOL</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".dual-collapse2">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
    <div class="navbar-collapse collapse w-100 order-3 dual-collapse2">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">

                 <label for="imageupload" class="custom-imageupload">
                  <i> </i>Upload-Image
                 </label>
                 <input id="imageupload" type="file" onchange="Display(this); threshold() ;" />


            </li>
        </ul>
    </div>
</nav>
  <div class="container-fluid">
<!-- ---------------------------------------------------------------------------------------------------- -->
    <div class="row">
            <nav class="left_side col-sm-1">

                      <div class="col-sm-1">
                        <button type="button" onclick="toggle();"> Toggle </button>
                      </div>
                      <br><br>

                      <div class="col-sm-1">

                        <button type="button" onclick="sendImg();"> Execute </button>
                      </div>
                      <br><br>
                      <div class="col-sm-1">
                        <button type="button" onclick="download();"> Download </button>
                      </div>
                        <br><br>

                        <div class="col-sm-1" id="CanvasRow" >
                          <br>
                          <br>
                          <br>

                          <h5 class=" col-sm-2">Tools</h5>
                          <br> <br>

                          <div class=" col-sm-2">
                                <button class="btn" onclick="getPencil()"><i class="glyphicon glyphicon-pencil"></i></button>
                                <br><br>
                                <button class="btn" onclick="getErasor()"><i class="glyphicon glyphicon-erase"></i></button>
                          </div>


                          <br><br><br><br>
                          <br>
                          <br>
                          <h5 class=" col-sm-2">Actions</h5>
                          <br> <br>

                          <div class=" col-sm-2">
                              <button class="btn" onclick="increaseSize()"><i class="glyphicon glyphicon-plus"></i></button>
                              <br>
                              <br>
                              <button class="btn" onclick="decreaseSize()"><i class="glyphicon glyphicon-minus-sign"></i></button>

                              <br> <br>
                          </div>
                        </div>

            </nav>


                <div class="col-sm-11" >

                  <div class="col-sm-8 imagedisplay" >
                        <br>
                        <canvas  id="Q2"               width=800px height=500px  > </canvas>
                        <canvas  id="Q3" class="small" width=800px height=500px  > </canvas>
                        <canvas  id="Q4"               width=800px height=500px  > </canvas>

                        <script src="/static/draw.js"></script>
                  </div>
                  <div class="col-sm-3 slider">

                  <!-- <br> -->
                     <input type="range" min="0" max="100" value="20" class="slider red" id="S1"> <br>
                     <input type="range" min="0" max="100" value="20" class="slider red" id="S2"> <br>
                     <input type="range" min="0" max="100" value="20" class="slider red" id="S3"> <br>

                   </div>

                </div>
</div>

<!-- ----------------------------------------------------------------------------------------------------- -->

</div>

<script type="text/javascript">

  function add(accumulator, a) {
    return accumulator + a;
  }

  function dilateCanvas() {
    var canv3 = document.getElementById("Q3");
    var context3 = canv3.getContext("2d");
    // context3.scale(1/2, 1/2);
    var cnvImg = context3.getImageData(0, 0, canv3.width, canv3.height);
    var binImg = [];
    for (i = 0; i < cnvImg.data.length; i += 4)  {
      if (cnvImg.data[i] + cnvImg.data[i+1] + cnvImg.data[i+2] + cnvImg.data[i+3] > 255) {
        binImg.push(1);
      } else {
        binImg.push(0);
      }
    }
    var morph = new Morph(canv3.width, canv3.height, binImg);
    // console.log(morph.data.reduce(add));
    morph.dilateWithElement();
    // console.log(morph.data.reduce(add));

    context3.clearRect(0, 0, canv3.width, canv3.height);
    cnvImg = context3.getImageData(0, 0, canv3.width, canv3.height);
    for (i = 0; i < cnvImg.data.length; i += 4)  {
      if (morph.data[i/4] == 1) {
        cnvImg.data[i] = cnvImg.data[i+3] = 255;
        cnvImg.data[i+1] = cnvImg.data[i+2] = 0;
      } else {
        cnvImg.data[i] = cnvImg.data[i+1] = cnvImg.data[i+2] = cnvImg.data[i+3] = 0;
      }
    }

    context3.putImageData(cnvImg, 0, 0);
    // return morph;
  }

</script>

<script type="text/javascript">

  function sendImg() {
    var scratchCanvas = document.getElementById('Q3');
console.log(scratchCanvas);
var dataURL = scratchCanvas.toDataURL();
var img_id = '';
$.ajax({
  type: "POST",
  url: "http://127.0.0.1:5000/",
  data: { 'image': dataURL },
  success: function(result) { console.log('http://127.0.0.1:5000/static/uploads/' + result + '.jpg');
  img_id = result;
var ctx = document.getElementById('Q3');
    if (ctx.getContext) {

        ctx = ctx.getContext('2d');

        //Loading of the home test image - img1
        var img1 = new Image();

        //drawing of the test image - img1
        img1.onload = function () {
            //draw background image
            ctx.drawImage(img1, 0, 0);
            // //draw a box over the top
            // ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
            // ctx.fillRect(0, 0, 1000, 500);
            console.log(img1);


          var canv3 = document.getElementById("Q3");
  var context3 = canv3.getContext("2d");
  var binaryImageData = context3.getImageData(0, 0, canv3.width, canv3.height);

  // Reseize image to canv width and can height

  var i;
  i = 0;
  for (i = 0; i < binaryImageData.data.length; i += 4)
  {

    if(binaryImageData.data[i] ==255 && binaryImageData.data[i+1]==255 && binaryImageData.data[i+2]==255)
    {
      binaryImageData.data[i] = 255;
      binaryImageData.data[i+1] = 0;
      binaryImageData.data[i+2] = 0;
      binaryImageData.data[i+3] = 255;


    }
    else
    {
      binaryImageData.data[i] = 0;
      binaryImageData.data[i+1] = 0;
      binaryImageData.data[i+2] = 0;
      binaryImageData.data[i+3] = 0;
    }
  }
  context3.putImageData(binaryImageData, 0, 0);
        };



        img1.src = 'http://127.0.0.1:5000/static/uploads/'+result+'.jpg';
        console.log(img1.src);


        // img1.crossOrigin = 'anonymous'
    }
   }
}).done(function() {
  console.log('sent');
  });
console.log(img_id);

}
</script>


</body>
</html>
